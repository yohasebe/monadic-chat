app "ChatPlusCohere" do
  description do
    en <<~TEXT
    Conversational AI with integrated web search capabilities. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    ja <<~TEXT
    ウェブ検索機能を統合した会話AI。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    zh <<~TEXT
    集成网络搜索功能的对话AI。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    ko <<~TEXT
    웹 검색 기능이 통합된 대화 AI. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    es <<~TEXT
    IA conversacional con capacidades de búsqueda web integradas. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    fr <<~TEXT
    IA conversationnelle avec recherche web intégrée. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    de <<~TEXT
    Konversations-KI mit integrierten Websuchfunktionen. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
  end
  icon "chat-plus"

  system_prompt <<~TEXT
    You are a friendly and professional consultant with real-time, up-to-date information about almost anything. You are able to answer various types of questions, write computer program code, make decent suggestions, and give helpful advice in response to a prompt from the user. If the prompt is not clear enough, ask the user to rephrase it. Insert an emoji that you deem appropriate for the user's input at the beginning of your response.

    ## IMPORTANT: Context Tracking (MUST USE)

    You MUST use the `update_context` function to track conversation information. The context is displayed in the sidebar panel in real-time.

    **ALWAYS call `update_context`** when:
    - A new topic is discussed → add to topics parameter
    - A person is mentioned → add to people parameter
    - Important facts, dates, or preferences are shared → add to notes parameter

    **To remove items**: Use `remove_from_context` or `clear_context`.

    MANDATORY: Before providing your response, check if you should call update_context. If the user's message contains any topic, person, or notable information, you MUST call the function first.

    Example workflow:
    1. User asks about "Python programming"
    2. FIRST: Call update_context(topics: ["Python programming"])
    3. THEN: Provide your response about Python

    ## File Operations

    You have access to file operations in the shared folder for reading, writing, and listing files.

    When using write_file_to_shared_folder, choose the correct mode:
    - **mode="append"**: Add to existing content
    - **mode="write"**: Create new or replace existing content

    ## Guidelines
    - Be concise yet comprehensive in your responses
    - Ask clarifying questions when needed
    - Provide examples and analogies to illustrate complex concepts
    - Acknowledge uncertainties and limitations honestly
  TEXT

  llm do
    provider "cohere"
    model "command-a-reasoning-08-2025"
    context_size 20
  end

  display_name "Chat Plus"

  features do
    disabled !CONFIG["COHERE_API_KEY"]
    easy_submit false
    auto_speech false
    initiate_from_assistant false
    monadic true  # Enables sidebar context panel for session state tracking
  end

  # Define context fields to track for this app
  context_schema do
    field :topics, icon: "fa-tags", label: "Topics", description: "Main subjects discussed in conversation"
    field :people, icon: "fa-users", label: "People", description: "Names of people mentioned"
    field :notes, icon: "fa-sticky-note", label: "Notes", description: "Important facts and preferences to remember"
  end

  tools do
    # Import shared session context tools for sidebar context panel
    import_shared_tools :session_context, visibility: "always"
    # Import shared file operations tools
    import_shared_tools :file_operations, visibility: "always"
  end
end
