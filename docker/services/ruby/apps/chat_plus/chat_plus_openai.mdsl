app "ChatPlusOpenAI" do
  description do
    en <<~TEXT
    Conversational AI grounded in your PDFs. Import and persist documents locally or in OpenAI's Vector Store, then chat with citations from their contents. Web search is optional. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    ja <<~TEXT
    PDFを知識ベースとして会話するAI。文書をローカルまたはOpenAIのVector Storeに保存し、内容に基づいて（出典付きで）回答します。ウェブ検索は任意で有効化できます。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    zh <<~TEXT
    以您的PDF为知识基础的对话AI。将文档持久化到本地或OpenAI向量存储，并基于其内容（附引用）进行对话；网页搜索为可选。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    ko <<~TEXT
    PDF를 지식 기반으로 사용하는 대화형 AI. 문서를 로컬 또는 OpenAI Vector Store에 저장하고, 그 내용에 근거해 인용과 함께 대화합니다. 웹 검색은 선택 사항입니다. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    es <<~TEXT
    IA conversacional basada en tus PDF. Importa y guarda documentos localmente o en el Vector Store de OpenAI, y conversa citando su contenido. La búsqueda web es opcional. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    fr <<~TEXT
    IA conversationnelle ancrée dans vos PDF. Importez et conservez vos documents en local ou dans le Vector Store d'OpenAI, puis discutez en citant leur contenu. La recherche web est optionnelle. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT

    de <<~TEXT
    Konversations-KI, die auf Ihren PDFs basiert. Dokumente lokal oder im OpenAI Vector Store speichern und mit Zitaten aus deren Inhalten chatten. Websuche ist optional. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=chat-plus" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
  end
  icon "chat-plus"

  system_prompt <<~TEXT
    You are a friendly and professional consultant with real-time, up-to-date information about almost anything. You are able to answer various types of questions, write computer program code, make decent suggestions, and give helpful advice in response to a prompt from the user. If the prompt is not clear enough, ask the user to rephrase it. Insert an emoji that you deem appropriate for the user's input at the beginning of your response.

    ## File Operations

    You have access to file operations in the shared folder for reading, writing, and listing files.

    When using write_file_to_shared_folder, choose the correct mode:
    - **mode="append"**: Add to existing content
    - **mode="write"**: Create new or replace existing content

    ## PDF Document Search

    You have access to PDF documents through two storage systems:
    1) Local PDF Database — via the tools: find_closest_doc, find_closest_text, list_titles, get_text_snippet, get_text_snippets
    2) Cloud Vector Store (OpenAI) — via the file_search tool when available

    When the user asks about PDF content:
    - If file_search tool is available, try it first
    - If no results or not available, use local PDF tools
    - Call at most ONCE per source for a given request
    - Include citation footer with Doc Title, Snippet tokens, and position
  TEXT

  llm do
    provider "openai"
    model ["gpt-5.1", "gpt-4.1"]
    reasoning_effort "minimal"
    context_size 20
  end

  display_name "Chat Plus"

  features do
    easy_submit false
    auto_speech false
    initiate_from_assistant false
    pdf_vector_storage true
    monadic true  # Enables sidebar context panel for session state tracking
  end

  # Define context fields to track for this app
  context_schema do
    field :topics, icon: "fa-tags", label: "Topics", description: "Main subjects discussed in conversation"
    field :people, icon: "fa-users", label: "People", description: "Names of people mentioned"
    field :notes, icon: "fa-sticky-note", label: "Notes", description: "Important facts and preferences to remember"
  end

  tools do
    # Import shared file operations tools
    import_shared_tools :file_operations, visibility: "always"
  end
end
