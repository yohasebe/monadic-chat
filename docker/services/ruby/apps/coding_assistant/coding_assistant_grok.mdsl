app "CodingAssistantGrok" do
  description do
    en <<~TEXT
    Programming help with code suggestions and explanations. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    ja <<~TEXT
    コードの提案と説明によるプログラミング支援。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    zh <<~TEXT
    提供代码建议和解释的编程帮助。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    ko <<~TEXT
    코드 제안과 설명을 통한 프로그래밍 지원. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    es <<~TEXT
    Ayuda de programación con sugerencias y explicaciones de código. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    fr <<~TEXT
    Aide à la programmation avec suggestions et explications de code. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    de <<~TEXT
    Programmierhilfe mit Code-Vorschlägen und Erklärungen. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
  end
  
  icon "laptop-code"
  
  system_prompt <<~PROMPT
  You are a friendly but professional software engineer who answers various questions, writes computer program code, makes decent suggestions, and gives helpful advice in response to a user's prompt.

  It is often not possible to present a very long block of code in a single response. In such cases, the code block can be split into multiple parts and the complete code can be provided to the user in sequence. This is very important because the markdown text is converted to HTML and displayed to the user. If the original markdown is corrupted, the converted HTML will not display properly. If a code block needs to be split into multiple parts, each partial code segment should be enclosed with a pair of code block separators within the same response.

  First, briefly inform the user in English that they can provide prompts describing the problem or task they wish to solve. Also, if there is code to be used in the session, code to be modified, or a dataset to be used, let the user know that the code or data to be retained should be sent with the `Role` in the message sending screen set to `System`.

  Suggestions for modifying the code are allowed to show the differences when the modification points are clear and there is no possibility of misunderstanding, but when there is even a slight possibility of misunderstanding, please show the entire file without omitting it. Note that only one file is shown in one response. However, when the file is large, it can be divided into multiple responses. In that case, be sure to divide the file properly so that the content of the file does not break off in the middle.
  PROMPT
  
  llm do
    provider "xai"
    model "grok-4-fast-reasoning"
    temperature 0.0
  end
  
  display_name "Coding Assistant"
 
  features do
    disabled !CONFIG["XAI_API_KEY"]
    easy_submit false
    auto_speech false
    image true
    pdf false
    sourcecode true
    mathjax false
    initiate_from_assistant false
    group "xAI"
  end

  tools do
    # File operations
    define_tool "read_file_from_shared_folder", "Read a file from the shared folder" do
      parameter :filepath, "string", "Path to the file (relative to shared folder or absolute)", required: true
    end

    define_tool "write_file_to_shared_folder", "Write or update a file in the shared folder" do
      parameter :filepath, "string", "Path to the file (relative to shared folder or absolute)", required: true
      parameter :content, "string", "Content to write to the file", required: true
      parameter :mode, "string", "Write mode: 'write' to overwrite, 'append' to add (default: 'write')", required: false
    end

    define_tool "list_files_in_shared_folder", "List files and directories in the shared folder" do
      parameter :directory, "string", "Subdirectory path (leave empty for root)", required: false
    end

    # Grok-Code agent for complex code generation
    define_tool "grok_code_agent", "Call Grok-Code-Fast-1 agent for complex coding tasks" do
      parameter :task, "string", "Description of the code generation task", required: true
      parameter :context, "string", "Additional context about the project or requirements", required: false
      parameter :files, "array", "Array of file objects with path and content", required: false
    end
  end
end
