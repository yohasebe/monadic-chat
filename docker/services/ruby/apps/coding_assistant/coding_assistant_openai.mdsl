app "CodingAssistantOpenAI" do
  description do
    en <<~TEXT
    Programming help with code suggestions and explanations. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    ja <<~TEXT
    コードの提案と説明によるプログラミング支援。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    zh <<~TEXT
    提供代码建议和解释的编程帮助。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    ko <<~TEXT
    코드 제안과 설명을 통한 프로그래밍 지원. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    es <<~TEXT
    Ayuda de programación con sugerencias y explicaciones de código. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    fr <<~TEXT
    Aide à la programmation avec suggestions et explications de code. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    de <<~TEXT
    Programmierhilfe mit Code-Vorschlägen und Erklärungen. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=coding-assistant" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
  end
  
  icon "laptop-code"
  
  system_prompt <<~PROMPT
  You are a friendly but professional software engineer who answers various questions, writes computer program code, makes decent suggestions, and gives helpful advice in response to a user's prompt.

  ## Your Capabilities
  - You can read, write, and list files in the user's shared folder
  - You have access to GPT-5-Codex, a specialized coding model, for complex tasks
  - You can analyze code, suggest improvements, and help with debugging

  ## Working with Files
  When the user asks you to work with files:
  1. Use `read_file_from_shared_folder` to read existing files
  2. Use `write_file_to_shared_folder` to create or update files
  3. Use `list_files_in_shared_folder` to explore the directory structure

  ## Using GPT-5-Codex Agent
  For complex coding tasks, you can delegate to GPT-5-Codex using `gpt5_codex_agent`.
  This specialized model excels at:
  - Writing complete applications
  - Complex refactoring
  - Detailed code reviews
  - Performance optimization
  Use it when the task requires deep coding expertise.

  ## Initial Message
  First, inform the user in English that they can:
  1. Provide prompts describing coding problems or tasks
  2. Ask you to read/write files in their shared folder
  3. Request complex coding assistance via GPT-5-Codex agent for more complex tasks

  If your response continues in the next message, you should use the following special string at the end of the message: "Press <button class='btn btn-secondary btn-sm contBtn'>continue</button> to get more results"
  PROMPT
  
  llm do
    provider "openai"
    model ["gpt-5", "gpt-4.1"]
    reasoning_effort "minimal"
    temperature 0.0

    agents do
      code_generator model: "gpt-5-codex"
    end
  end

  display_name "Coding Assistant"
 
  features do
    disabled !CONFIG["OPENAI_API_KEY"]
    easy_submit false
    auto_speech false
    image true
    pdf false
    sourcecode true
    mathjax false
    initiate_from_assistant true
  end

  tools do
    # File operations
    define_tool "read_file_from_shared_folder", "Read a file from the shared folder" do
      parameter :filepath, "string", "Path to the file (relative to shared folder or absolute)", required: true
    end

    define_tool "write_file_to_shared_folder", "Write or update a file in the shared folder" do
      parameter :filepath, "string", "Path to the file (relative to shared folder or absolute)", required: true
      parameter :content, "string", "Content to write to the file", required: true
      parameter :mode, "string", "Write mode: 'write' to overwrite, 'append' to add (default: 'write')", required: false
    end

    define_tool "list_files_in_shared_folder", "List files and directories in the shared folder" do
      parameter :directory, "string", "Subdirectory path (leave empty for root)", required: false
    end

    # GPT-5-Codex agent for complex coding tasks
    define_tool "gpt5_codex_agent", "Delegate complex coding tasks to GPT-5-Codex" do
      parameter :task, "string", "Description of the coding task", required: true
      parameter :context, "string", "Additional context or requirements", required: false
      parameter :files, "array", "Array of file objects with path and content", required: false
    end
  end
end
