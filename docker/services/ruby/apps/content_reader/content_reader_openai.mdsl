app "ContentReaderOpenAI" do
  display_name "Content Reader"
  description do
    en <<~TEXT
    Extract and analyze text from documents and PDFs. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=content-reader" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    ja <<~TEXT
    文書とPDFからテキスト抽出と分析。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=content-reader" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    zh <<~TEXT
    从文档和PDF中提取和分析文本。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=content-reader" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    ko <<~TEXT
    문서와 PDF에서 텍스트 추출 및 분석. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=content-reader" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    es <<~TEXT
    Extraer y analizar texto de documentos y PDFs. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=content-reader" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    fr <<~TEXT
    Extraire et analyser du texte de documents et PDFs. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=content-reader" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    de <<~TEXT
    Text aus Dokumenten und PDFs extrahieren und analysieren. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=content-reader" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
  end
  icon "leanpub"

  system_prompt <<~TEXT
    You are a professional who explains various concepts easily to even beginners in the field. You can use whatever language the user is comfortable with.

    IMPORTANT: Each file should be read only ONCE. After successfully reading a file, DO NOT attempt to read it again.

    When the user mentions a filename (with or without extension), treat it as a local file and use the appropriate function to read it:
    - PDF files: Use `fetch_text_from_pdf`
    - Office files (.docx, .xlsx, .pptx): Use `fetch_text_from_office`
    - Text/Code files: Use `fetch_text_from_file`
    - Images: Use `analyze_image`
    - Audio: Use `analyze_audio`

    For multiple files:
    1. Read each file ONCE
    2. Store the content in your response
    3. Compare or analyze the content as requested
    4. DO NOT re-read files you have already successfully read

    Only use web search or fetch_web_content when the user provides a URL starting with "http://" or "https://".
  TEXT
  
  llm do
    provider "OpenAI"
    model ["gpt-5", "gpt-4.1"]
    reasoning_effort "low"  # web_search requires low or higher
    temperature 0.0
    context_size 10
  end
  
  features do
    disabled !CONFIG["OPENAI_API_KEY"]
    easy_submit false
    auto_speech false
    initiate_from_assistant true
    mathjax true
    websearch true
  end
  
  tools do
    # Import shared file operations tools (always visible - Phase 1)
    import_shared_tools :file_operations, visibility: "always"

    # Import unified web search tools (conditional - native or Tavily)
    import_shared_tools :web_search_tools, visibility: "conditional"

    # Import shared content analysis tools (conditional - requires OpenAI API key)
    import_shared_tools :content_analysis_openai, visibility: "conditional"

    define_tool "fetch_text_from_pdf", "Extract text content from a PDF file" do
      parameter :pdf, "string", "The filename of the PDF to read", required: true
    end

    define_tool "fetch_text_from_office", "Extract text content from Office files (docx, xlsx, pptx)" do
      parameter :file, "string", "The filename of the Office file to read", required: true
    end

    define_tool "fetch_text_from_file", "Read text content from a file" do
      parameter :file, "string", "The filename to read", required: true
    end
  end
end