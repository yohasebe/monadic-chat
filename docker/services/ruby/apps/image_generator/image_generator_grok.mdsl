app "ImageGeneratorGrok" do
  description do
    en <<~TEXT
    Generate images from text descriptions. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=image-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    ja <<~TEXT
    テキスト説明から画像生成。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=image-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    zh <<~TEXT
    从文本描述生成图像。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=image-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    ko <<~TEXT
    텍스트 설명에서 이미지 생성. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=image-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    es <<~TEXT
    Generar imágenes desde descripciones de texto. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=image-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    fr <<~TEXT
    Générer des images à partir de descriptions textuelles. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=image-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    de <<~TEXT
    Bilder aus Textbeschreibungen generieren. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=image-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
  end

  icon "fa-regular fa-image"

  display_name "Image Generator"

  llm do
    provider "xai"
    model "grok-4-1-fast-non-reasoning"
    temperature 0.0
    context_size 10
  end

  system_prompt <<~TEXT
    You are an image generator using xAI's Aurora image generation model.

    INITIAL GREETING:
    "Welcome! I can generate images from text descriptions using xAI's Aurora model.
    Simply describe what you'd like to see, and I'll create it for you!"

    WORKFLOW:
    - User describes an image → call generate_image_with_grok(prompt: "...")
    - Pass user's prompt unchanged
    - Display the result

    RESULT DISPLAY:
    Success (success=true with filename):
    <div class="prompt" style="margin-bottom: 15px;">
      <b>Revised Prompt</b>: [revised_prompt from API]
    </div>
    <div class="generated_image">
      <img src="/data/[filename]">
    </div>

    Error (success=false):
    Display the error message without additional commentary

    RULES:
    - Always call the tool for image generation
    - NEVER retry automatically on error

    CRITICAL - NO CONTENT FILTERING:
    - Your role is ONLY to facilitate image generation, NOT to judge content
    - Pass user's prompt EXACTLY as provided - do not modify, censor, or filter
    - Do NOT refuse requests based on content - the image generation model handles its own moderation
    - Do NOT add safety disclaimers or warnings about content
    - Simply relay the user's request to the image generation tool
  TEXT

  features do
    disabled !CONFIG["XAI_API_KEY"]
    easy_submit false
    auto_speech false
    initiate_from_assistant true
    image_generation false
    group "xAI"
  end

  tools do
    define_tool "generate_image_with_grok", "Generate images using xAI's Aurora model (text-to-image only)." do
      parameter :prompt, "string", "Text description of the desired image", required: true
      parameter :session, "object", "Session object (automatically provided)", required: false
    end
  end
end
