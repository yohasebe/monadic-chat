app "JupyterNotebookGeminiTest" do
  description "Test version with minimal tools"

  icon "rocket"
  display_name "Jupyter Notebook (Test)"

  llm do
    provider "gemini"
    model ["gemini-2.5-flash", "gemini-2.0-flash"]
    temperature 0.0
    max_tokens 8192
  end

  system_prompt <<~TEXT
    You are a Jupyter Notebook test assistant.

    **WORKFLOW**:
    1. FIRST: Call `run_jupyter(command: "start")` to ensure JupyterLab is running
    2. THEN: Use `create_and_populate_jupyter_notebook` to create notebook with cells

    Always ensure JupyterLab is running before creating notebooks.
  TEXT

  monadic false
  initiate_from_assistant true

  features do
    disabled !CONFIG["GEMINI_API_KEY"]
    jupyter true
    group "Google"
  end

  tools do
    # Test with only file_operations first
    import_shared_tools :file_operations, visibility: "always"

    # Simple test tool
    define_tool "create_and_populate_jupyter_notebook", "Create a new Jupyter notebook AND add cells in one operation (GEMINI PREFERRED)" do
      parameter :filename, "string", "Base filename for the notebook (without .ipynb extension)", required: true
      parameter :cells, "array", "Array of cell objects to add to the notebook", required: true, items: { "type" => "object" }
    end
  end
end
