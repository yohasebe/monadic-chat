app "MathTutorGemini" do
  display_name MathTutor::DISPLAY_NAME
  description MathTutor::DESCRIPTION
  icon MathTutor::ICON
  
  system_prompt MathTutor::SYSTEM_PROMPT
  
  llm do
    provider "gemini"
    model ["gemini-2.5-flash", "gemini-2.0-flash"]
    temperature 0.0
    max_tokens 8192
    reasoning_effort "minimal"  # For better function calling
  end
  
  features do
    disabled !CONFIG["GEMINI_API_KEY"]
    easy_submit false
    auto_speech false
    initiate_from_assistant true
    image true
    mathjax true
    group "Google"
  end
  
  # Tool definitions for Gemini's format
  tools [
    {
      "name" => "run_code",
      "description" => "Run program code and return the output",
      "parameters" => {
        "type" => "object",
        "properties" => {
          "command" => {
            "type" => "string",
            "description" => "Program that execute the code (e.g., 'python')"
          },
          "code" => {
            "type" => "string",
            "description" => "Program code to be executed"
          },
          "extension" => {
            "type" => "string",
            "description" => "File extension of the code when it is temporarily saved to be run (e.g., 'py')"
          }
        },
        "required" => ["command", "code", "extension"]
      }
    },
    {
      "name" => "run_bash_command",
      "description" => "Run a bash command and return the output",
      "parameters" => {
        "type" => "object",
        "properties" => {
          "command" => {
            "type" => "string",
            "description" => "Bash command to be executed"
          }
        },
        "required" => ["command"]
      }
    },
    {
      "name" => "check_environment",
      "description" => "Check the environment setup and available tools",
      "parameters" => {
        "type" => "object",
        "properties" => {},
        "required" => []
      }
    },
    {
      "name" => "fetch_text_from_file",
      "description" => "Fetch the text from a file and return its content",
      "parameters" => {
        "type" => "object",
        "properties" => {
          "file" => {
            "type" => "string",
            "description" => "File name or file path"
          }
        },
        "required" => ["file"]
      }
    }
  ]
end