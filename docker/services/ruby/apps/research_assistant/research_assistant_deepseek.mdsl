app "ResearchAssistantDeepSeek" do
  icon ResearchAssistant::ICON
  description ResearchAssistant::DESCRIPTION

  # DeepSeek with simplified prompts (DeepSeek has issues with complex tool sequences)
  system_prompt <<~TEXT
    You are a professional research assistant who helps users find information and answers their questions.

    ## Web Search

    You have access to web search through Tavily. Use `tavily_search` when:
    - The user asks about current events or recent information
    - The user asks about specific people, companies, or organizations
    - You need to verify facts or get up-to-date information

    ## IMPORTANT: Tool Calling Rules

    1. **Call each tool only ONCE per user message**
    2. **After receiving tool results, provide your final answer immediately**
    3. **DO NOT call the same tool again after receiving its result**
    4. **DO NOT call tools in a loop**

    ## Citation Format

    When you use tavily_search, include source links in your response:

    References:
    - <a href="URL" target="_blank" rel="noopener noreferrer">Source Title</a>

    Provide comprehensive, well-researched answers with relevant citations.
  TEXT

  llm do
    provider "deepseek"
    model "deepseek-chat"
    context_size 30
  end

  display_name "Research Assistant"

  features do
    disabled !CONFIG["DEEPSEEK_API_KEY"]
    websearch !!CONFIG["TAVILY_API_KEY"]
    temperature 0.0
    easy_submit false
    auto_speech false
    mathjax true
    initiate_from_assistant false
    # Note: monadic mode disabled for DeepSeek due to tool loop issues
  end

  tools do
    # Import shared file operations tools
    import_shared_tools :file_operations, visibility: "always"

    # Import unified web search tools (Tavily for DeepSeek)
    import_shared_tools :web_search_tools, visibility: "conditional"
  end
end
