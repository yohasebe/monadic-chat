app "ResearchAssistantPerplexity" do
  icon ResearchAssistant::ICON
  description ResearchAssistant::DESCRIPTION
  system_prompt ResearchAssistant::INITIAL_PROMPT

  llm do
    provider "perplexity"
    model "llama-3.1-sonar-small-128k-online"
  end

  display_name "Research Assistant"

  features do
    disabled !CONFIG["PERPLEXITY_API_KEY"]
    websearch false  # Perplexity has built-in web search
    temperature 0.0
    easy_submit false
    auto_speech false
    mathjax true
    image true
    toggle true
  end

  tools do
    define_tool "fetch_text_from_pdf", "Extract text content from a PDF file" do
      parameter :pdf, "string", "The filename of the PDF to read", required: true
    end

    define_tool "fetch_text_from_office", "Extract text content from Office files (docx, xlsx, pptx)" do
      parameter :file, "string", "The filename of the Office file to read", required: true
    end

    define_tool "fetch_text_from_file", "Fetch text content from a file" do
      parameter :file, "string", "The filename to read", required: true
    end

    define_tool "analyze_image", "Analyze an image and return description" do
      parameter :message, "string", "Question or instruction about the image", required: true
      parameter :image_path, "string", "Path to the image file or URL", required: true
    end

    define_tool "analyze_audio", "Analyze audio and return transcription" do
      parameter :audio_path, "string", "Path to the audio file", required: true
    end
  end
end