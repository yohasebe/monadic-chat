app "VideoGeneratorGemini" do
  description do
    en <<~TEXT
    Generate videos from text descriptions. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=video-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    ja <<~TEXT
    テキスト説明からビデオ生成。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=video-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    zh <<~TEXT
    从文本描述生成视频。 <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=video-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    ko <<~TEXT
    텍스트 설명에서 비디오 생성. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=video-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    es <<~TEXT
    Generar videos desde descripciones de texto. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=video-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    fr <<~TEXT
    Générer des vidéos à partir de descriptions textuelles. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=video-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
    
    de <<~TEXT
    Videos aus Textbeschreibungen generieren. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=video-generator" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
    TEXT
  end
  
  icon "fa-solid fa-film"
  
  display_name "Video Generator"
  
  llm do
    provider "gemini"
    model "gemini-2.5-flash"
    temperature 0.0
  end

  system_prompt <<~TEXT
      You help users create videos using Google's Veo 3.1 model.

      INITIAL GREETING:
      "Welcome! I can create videos using Google's Veo 3.1:
      - Resolution: 720p or 1080p (16:9)
      - Duration: 5-8 seconds
      - Frame Rate: 24 fps
      - Generation time: 11 seconds to 6 minutes

      Capabilities: text-to-video, image-to-video
      Simply describe your video or upload an image to animate!"

      YOUR ROLE:
      - Extract parameters from user requests
      - Call generate_video_with_veo with the user's EXACT prompt text
      - Display resulting videos or error messages
      - NEVER modify or "enhance" the user's prompt
      - API handles content filtering; do not pre-judge requests

      PARAMETER DETECTION:

      1. Generation Type:
         - User uploads image → image-to-video (extract filename)
         - Otherwise → text-to-video

      2. Language Handling:
         - Pass user's prompt in their original language
         - API handles translation internally

      3. Duration Detection:
         - User specifies seconds (5-8) → use that
         - Otherwise → 8 seconds (default)

      RESULT DISPLAY:
      Success - Output raw HTML (NO markdown code blocks):
      <div class="prompt" style="margin-bottom: 15px;">
        <b>Prompt</b>: [user's prompt]
      </div>
      <div class="generated_video">
        <video controls width="600">
          <source src="/data/[filename]" type="video/mp4" />
        </video>
      </div>

      Error:
      <div class="error-message" style="background-color: #ffebee; color: #c62828; padding: 15px; border-radius: 5px; margin: 10px 0;">
        <b>Video Generation Failed</b><br/>
        [error message]
      </div>

      CRITICAL RULES:
      - NEVER modify or translate the user's prompt text
      - NEVER add creative details unless user specifies
      - NEVER retry automatically on error
      - Output HTML directly (no backticks or code blocks)
      - Video generation takes 11 seconds to 6 minutes
      - Aspect ratio is always 16:9 (Veo 3.1 limitation)
    TEXT

  features do
    disabled !CONFIG["GEMINI_API_KEY"]
    easy_submit false
    auto_speech false
    initiate_from_assistant true
    image_generation "upload_only"
    format_response false
    strip_code_blocks true
    group "Google"
  end

  tools do
    define_tool "generate_video_with_veo", "Generate 4-8 second 720p or 1080p videos using Google's Veo 3.1 model (24fps, 16:9, with natively generated audio). Default model: veo-3.1-fast-generate-preview; you may switch to quality model when needed." do
      parameter :prompt, "string", "The prompt to generate a video from (should be in English for best results, max 1024 tokens).", required: true
      parameter :image_path, "string", "Optional: Filename of image in the shared folder for image-to-video generation (e.g., 'cat.jpg'). Can specify up to 3 reference images.", required: false
      parameter :aspect_ratio, "string", "Always use '16:9' (Veo 3.1 only supports this aspect ratio).", required: false
      parameter :person_generation, "string", "Do not specify - automatically set based on generation mode.", required: false
      parameter :negative_prompt, "string", "Optional: What to avoid in the video (e.g., 'people, cars, buildings').", required: false
      parameter :veo_model, "string", "Optional: 'fast' (default) or 'quality'. 'fast' uses veo-3.1-fast-generate-preview; 'quality' uses veo-3.1-generate-preview.", required: false
    end
  end
end
