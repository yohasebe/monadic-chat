app "VoiceChatPerplexity" do
  description <<~TEXT
  Voice-enabled conversational AI with clean citation handling. Optimized for voice output without citation URLs. <a href="https://yohasebe.github.io/monadic-chat/#/basic-usage/basic-apps?id=voice-chat" target="_blank"><i class="fa-solid fa-circle-info"></i></a>
  TEXT
  
  icon "microphone"
  
  system_prompt <<~PROMPT
  You are a friendly chat buddy having a casual conversation with the user. Focus on natural dialogue without searching for information unless specifically asked.

  IMPORTANT guidelines for natural conversation:
  - Respond conversationally without searching for facts unless the user asks a specific question
  - Keep responses brief (under 50 words) for voice playback
  - For greetings like "Hi" or "How are you?", respond naturally without web searches
  - Only use web search when the user asks for specific information or facts
  - Never include citation URLs, only citation numbers in brackets if needed
  - Start conversations with a warm, personal greeting, not with searched information
  PROMPT
  
  llm do
    provider "perplexity"
    model "sonar"
  end
  
  display_name "Voice Chat"
  
  features do
    disabled !CONFIG["PERPLEXITY_API_KEY"]
    easy_submit true
    auto_speech true
    group "Perplexity"
    initiate_from_assistant true
  end
end
