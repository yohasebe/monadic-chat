# ãƒ†ã‚¹ãƒˆã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ï¼ˆå†…éƒ¨å‘ã‘ï¼‰

Monadic Chatãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼å‘ã‘ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹**æ¨å¥¨**æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚

## å“²å­¦

- **ã‚·ãƒ³ãƒ—ãƒ«**ï¼šåŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆã«ã¯`rake test`ã‚’ä½¿ç”¨ï¼ˆRuby + JavaScript + Pythonï¼‰
- **ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹**ï¼šç‰¹å®šã®ã‚·ãƒŠãƒªã‚ªã«ã¯`rake test:profile[name]`ã‚’ä½¿ç”¨
- **å®£è¨€çš„**ï¼šãƒ†ã‚¹ãƒˆè¨­å®šã¯`config/test/test-config.yml`ã«å­˜åœ¨
- **çµ±ä¸€çš„ãªçµæœ**ï¼šã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆçµæœã¯`./tmp/test_results/`ã«ä¿å­˜

## æ—¥å¸¸ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### é–‹ç™ºä¸­

```bash
# ã‚¯ã‚¤ãƒƒã‚¯ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿ã€ç´„10-30ç§’ï¼‰
rake test:profile[quick]

# æ¨™æº–çš„ãªé–‹ç™ºãƒ†ã‚¹ãƒˆï¼ˆunit + integrationã€ç´„1-2åˆ†ï¼‰
rake test:profile[dev]

# ã‚·ãƒ³ãƒ—ãƒ«ãªå…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆRuby + JS + Pythonã€APIãªã—ã€ç´„2-3åˆ†ï¼‰
rake test
```

### ã‚³ãƒŸãƒƒãƒˆå‰

```bash
# ã‚³ãƒŸãƒƒãƒˆå‰æ¤œè¨¼ï¼ˆdevã¨åŒã˜ã ãŒè©³ç´°ãªå‡ºåŠ›ï¼‰
rake test:profile[commit]
```

### ãƒ—ãƒƒã‚·ãƒ¥ / PRå‰

```bash
# CIç›¸å½“ã®ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã‚’å«ã‚€ã€ç´„3-5åˆ†ï¼‰
# ~/monadic/config/envã«APIã‚­ãƒ¼ãŒå¿…è¦
rake test:profile[ci]
```

### å®Œå…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

```bash
# ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ†ã‚¹ãƒˆã‚’å«ã‚€å®Œå…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆï¼ˆç´„10-15åˆ†ï¼‰
# ã™ã¹ã¦ã®APIã‚­ãƒ¼ã®è¨­å®šãŒå¿…è¦
rake test:profile[full]

# ä»£æ›¿ï¼šãƒ¡ãƒ‡ã‚£ã‚¢ãƒ†ã‚¹ãƒˆã‚’å«ã‚€çµ±ä¸€ãƒ©ãƒ³ãƒŠãƒ¼
rake test:all[full]
```

## åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« | ã‚¹ã‚¤ãƒ¼ãƒˆ            | APIå‘¼ã³å‡ºã— | ãƒ¡ãƒ‡ã‚£ã‚¢ | é€Ÿåº¦    | ä½¿ç”¨ä¾‹                    |
|------------|---------------------|-----------|--------|---------|-------------------------|
| `quick`    | unit                | ãªã—      | ãªã—   | âš¡ é«˜é€Ÿ | ã‚¯ã‚¤ãƒƒã‚¯ã‚µãƒ‹ãƒ†ã‚£ãƒã‚§ãƒƒã‚¯    |
| `dev`      | unit + integration  | ãªã—      | ãªã—   | ğŸƒ ä¸­é€Ÿ | æ—¥å¸¸çš„ãªé–‹ç™º              |
| `commit`   | unit + integration  | ãªã—      | ãªã—   | ğŸƒ ä¸­é€Ÿ | ã‚³ãƒŸãƒƒãƒˆå‰æ¤œè¨¼            |
| `ci`       | unit + int + api    | ã‚ã‚Š      | ãªã—   | ğŸ¢ ä½é€Ÿ | CIãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ / ãƒ—ãƒƒã‚·ãƒ¥å‰ |
| `full`     | all suites          | ã‚ã‚Š      | ã‚ã‚Š   | ğŸŒ æœ€ä½é€Ÿ | å®Œå…¨æ¤œè¨¼                |
| `smoke`    | api only            | ã‚ã‚Š      | ãªã—   | ğŸƒ ä¸­é€Ÿ | ã‚¯ã‚¤ãƒƒã‚¯APIã‚µãƒ‹ãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ |

## ä¸€èˆ¬çš„ãªã‚·ãƒŠãƒªã‚ª

### ä½•ã‹ã‚’å£Šã—ã¦ã‚¯ã‚¤ãƒƒã‚¯ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦
```bash
rake test:profile[quick]
```

### çµ±åˆæ©Ÿèƒ½ã®é–‹ç™ºä¸­
```bash
rake test:profile[dev]
```

### ã‚³ãƒŸãƒƒãƒˆæº–å‚™å®Œäº†
```bash
rake test:profile[commit]
```

### APIçµ±åˆå¤‰æ›´ã®ãƒ†ã‚¹ãƒˆ
```bash
# ç‰¹å®šã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã¿
rake test:run[api,"providers=openai,anthropic,api_level=standard"]

# ã¾ãŸã¯ã‚¯ã‚¤ãƒƒã‚¯æ¤œè¨¼ã«smokeãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨
rake test:profile[smoke]
```

### ãƒ†ã‚¹ãƒˆå¤±æ•—ã®ãƒ‡ãƒãƒƒã‚°
```bash
# è©³ç´°å‡ºåŠ›ã§å®Ÿè¡Œ
rake test:run[unit,"format=documentation"]

# æœ€å¾Œã®ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤º
rake test:history[5]

# è©³ç´°ãªHTMLãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º
rake test:report
```

## å‡ºåŠ›ã®ç†è§£

### ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®å ´æ‰€
ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆçµæœã¯`./tmp/test_results/`ã«é›†ä¸­ä¿å­˜ã•ã‚Œã¾ã™ï¼š

```
tmp/test_results/
â”œâ”€â”€ latest/                           # æœ€æ–°ã®Rubyãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¸ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
â”œâ”€â”€ <run_id>/                         # Rubyãƒ†ã‚¹ãƒˆçµæœãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ summary_compact.md            # ç°¡æ½”ãªã‚µãƒãƒªãƒ¼
â”‚   â”œâ”€â”€ summary_full.md               # è©³ç´°ãªçµæœ
â”‚   â””â”€â”€ rspec_report.json             # æ©Ÿæ¢°å¯èª­JSON
â”œâ”€â”€ <run_id>_jest.json                # JavaScriptãƒ†ã‚¹ãƒˆçµæœï¼ˆJestï¼‰
â”œâ”€â”€ <run_id>_pytest.txt               # Pythonãƒ†ã‚¹ãƒˆå‡ºåŠ›
â”œâ”€â”€ all_<timestamp>.json              # çµ±åˆãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚µãƒãƒªãƒ¼
â””â”€â”€ index_all_<timestamp>.html        # çµ±åˆçµæœãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
```

### ã‚¯ã‚¤ãƒƒã‚¯è¦ç´„
```bash
# æœ€å¾Œã®ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤º
rake test:summary:latest

# 2ã¤ã®å®Ÿè¡Œã‚’æ¯”è¼ƒ
rake test:compare[run1,run2]
```

## è¨­å®š

### APIã‚­ãƒ¼
`~/monadic/config/env`ã§è¨­å®šï¼š
```bash
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
GEMINI_API_KEY=...
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
`config/test/test-config.yml`ã‚’ç·¨é›†ã—ã¦ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ï¼š
```yaml
profiles:
  my_custom:
    description: "My custom test configuration"
    suites: [unit, integration]
    api_level: none
    format: documentation
    timeout: 60
```

ãã®å¾Œå®Ÿè¡Œï¼š
```bash
rake test:profile[my_custom]
```

## éæ¨å¥¨ã‚¿ã‚¹ã‚¯ï¼ˆä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ï¼‰

âŒ **å¤ã„ã‚¹ã‚¿ã‚¤ãƒ«**ï¼ˆè¤‡é›‘ã€ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã‚„ã™ã„ï¼‰:
```bash
# ã“ã‚Œã‚‰ã¯ã‚‚ã†ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„
RUN_API=true PROVIDERS=openai,anthropic rake spec_api:smoke
ENV['API_TIMEOUT']=120 rake spec_e2e:chat
```

âœ… **æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ«**ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã€å®£è¨€çš„ï¼‰:
```bash
# ä»£ã‚ã‚Šã«ã“ã‚Œã‚‰ã‚’ä½¿ç”¨
rake test:profile[smoke]
rake test:run[e2e,"suite=chat,timeout=120"]
```

### ç§»è¡Œã‚¬ã‚¤ãƒ‰

| å¤ã„ã‚³ãƒãƒ³ãƒ‰ | æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ |
|-------------|-------------|
| `rake spec_unit` | `rake test:profile[quick]` |
| `rake spec_integration` | `rake test:profile[dev]` |
| `RUN_API=true rake spec_api:smoke` | `rake test:profile[smoke]` |
| `rake spec_e2e` | `rake test:profile[full]` |

## ãƒ’ãƒ³ãƒˆ

1. **å°ã•ãå§‹ã‚ã‚‹**ï¼šã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªé–‹ç™ºä¸­ã¯`quick`ã¾ãŸã¯`dev`ã‚’ä½¿ç”¨
2. **ã‚³ãƒŸãƒƒãƒˆå‰ã«commitãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ**ï¼šçµ±åˆå•é¡Œã‚’æ—©æœŸã«ã‚­ãƒ£ãƒƒãƒ
3. **CIã¯ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã®ã¿**ï¼šAPIãƒ†ã‚¹ãƒˆã¯é…ãã€ã‚¯ã‚©ãƒ¼ã‚¿ã‚’æ¶ˆè²»
4. **HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨**ï¼šã‚¿ãƒ¼ãƒŸãƒŠãƒ«å‡ºåŠ›ã‚ˆã‚Šãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒç°¡å˜
5. **å±¥æ­´ã‚’ç¢ºèª**ï¼šãƒã‚°ä¿®æ­£æ™‚ã«å‰å¾Œã‚’æ¯”è¼ƒ

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ†ã‚¹ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„
```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
cd /path/to/monadic-chat
rake test:profile[dev]
```

### APIã‚­ãƒ¼ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œãªã„
```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
ls -la ~/monadic/config/env

# ã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
grep API_KEY ~/monadic/config/env
```

### Dockerã‚¨ãƒ©ãƒ¼
```bash
# Docker Desktopã‚’æ‰‹å‹•ã§èµ·å‹•
# ã¾ãŸã¯Dockerãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—
rake test:profile[quick]  # Dockerã¯ä¸è¦
```

### ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„
```bash
# åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆ
rake test:help

# è¨­å®šã§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç¢ºèª
cat config/test/test-config.yml
```

## é«˜åº¦ãªä½¿ç”¨æ³•

### ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®šã‚’ä¸Šæ›¸ã
```bash
# devãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ãŒç•°ãªã‚‹ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§
rake test:run[integration,"timeout=120,api_level=none"]
```

### ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
```bash
# RSpecç›´æ¥
bundle exec rspec spec/unit/specific_spec.rb

# ã¾ãŸã¯ãƒ©ãƒ³ãƒŠãƒ¼ã‚’ä½¿ç”¨
rake test:run[unit,"files=spec/unit/specific_spec.rb"]
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚¹ãƒˆç’°å¢ƒ
```bash
# å®Ÿè¡Œå‰ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
EXTRA_LOGGING=true rake test:profile[dev]
```

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- å®Œå…¨ãªè©³ç´°ï¼š`docs_dev/test_runner.md`
- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®šï¼š`config/test/test-config.yml`
- å®Ÿè£…ï¼š`Rakefile`ã§`task 'test:profile'`ã‚’æ¤œç´¢
